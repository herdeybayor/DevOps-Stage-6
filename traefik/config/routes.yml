http:
  routers:
    # Auth API Router - Priority 10 (high)
    auth-api:
      rule: "Host(`stage6.hng.codeforgex.dev`) && (Path(`/login`) || PathPrefix(`/login/`))"
      service: auth-api
      entryPoints:
        - https
      priority: 10
      tls:
        certResolver: letsencrypt
      middlewares:
        - strip-login-slash

    # Todos API Router - Priority 10 (high)
    todos-api:
      rule: "Host(`stage6.hng.codeforgex.dev`) && PathPrefix(`/todos/`)"
      service: todos-api
      entryPoints:
        - https
      priority: 10
      tls:
        certResolver: letsencrypt

    # Users API Router - Priority 10 (high)
    users-api:
      rule: "Host(`stage6.hng.codeforgex.dev`) && PathPrefix(`/users/`)"
      service: users-api
      entryPoints:
        - https
      priority: 10
      tls:
        certResolver: letsencrypt

    # Zipkin Mock Router - Priority 5 (return 202 for tracing)
    zipkin-mock:
      rule: "Host(`stage6.hng.codeforgex.dev`) && Path(`/zipkin`)"
      service: zipkin-mock
      entryPoints:
        - https
      priority: 5
      tls:
        certResolver: letsencrypt

    # Frontend Router - Priority 1 (low, catch-all for everything else)
    frontend:
      rule: "Host(`stage6.hng.codeforgex.dev`)"
      service: frontend
      entryPoints:
        - https
      priority: 1
      tls:
        certResolver: letsencrypt

  services:
    # Auth API Service
    auth-api:
      loadBalancer:
        servers:
          - url: "http://auth-api:8000"

    # Todos API Service
    todos-api:
      loadBalancer:
        servers:
          - url: "http://todos-api:8082"

    # Users API Service
    users-api:
      loadBalancer:
        servers:
          - url: "http://users-api:8083"

    # Frontend Service
    frontend:
      loadBalancer:
        servers:
          - url: "http://frontend:80"

    # Zipkin Mock Service - Returns 202 Accepted for tracing
    zipkin-mock:
      staticResponse:
        status: 202

  middlewares:
    # Strip trailing slash from login path
    strip-login-slash:
      replacePathRegex:
        regex: "^/login/(.*)$"
        replacement: "/login$1"
